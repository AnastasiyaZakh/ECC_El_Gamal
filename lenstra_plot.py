import numpy as np
from algorithms import lenstra
from analytics import save_intervals_to_image, save_values_to_image
import random
from math import log
random.seed(0)
values = sorted([
    # 1_000_000_007*65537,

    # 3309641, 3614543, 3353489, 3396629, 3434941, 3475067, 3486437,
    # 3529697, 3564179, 3598457,
    # 3465523, 3788339, 3843607, 3876463, 3896429, 3908519, 3931427,
    # 3962347, 3970327, 4021681,
    # 3788693, 4131793, 4475761, 4492729, 4526761, 4572539, 4599263,
    # 4611917, 4650959, 4695211,
    # 4051031, 4421453, 5097721, 5106769, 5143517, 5171273, 5227421,
    # 5311433, 5334319, 5362099,
    # 4358993, 4752493, 5885641, 5895361, 5965481, 6032281, 6065531,
    # 6085771, 6133759, 6168269,
    # 4632737, 5050429, 6604453, 6656513, 6688037, 6709249, 6734963,
    # 6830687, 6884851, 6937471,
    # 4982521, 5447677, 7525421, 7575107, 7596763, 7618843, 7689809,
    # 7728499, 7772651, 7800361,
    # 5225849, 5695957, 8353573, 8394871, 8470193, 848464, 6256889,
    # 6657977, 7128029, 7591567,
    # 5530009, 6035273, 5581789, 6080791, 6605861, 7028789, 7534909,
    # 7995517, 8428727, 9029989,
    #
    # 7377781, 7416323, 7474091, 7552141, 7571561, 7638131, 7653773,
    # 7751917, 7779449, 7834741,
    # 8357213, 8393933, 8475913, 8496557, 8537917, 8550277, 8603801,
    # 8678321, 8720351, 8790641,
    # 9397051, 9487117, 9500077, 9539479, 9587009, 9659687, 9690899,
    # 9712529, 9769523, 9808943,
    # 10482191, 10513471, 10574021, 10597201, 10633439, 10665601,
    # 10706737, 10803691, 10835411, 10886539,
    # 11671783, 11705429, 11778929, 11828987, 11861923, 11974297,
    # 12045559, 12060043, 12150113, 12203071,
    # 12872243, 12896777, 12936307, 12990893, 13015511, 13057669,
    # 13097423, 13183799, 13275391, 13351411,
    #
    # 15395927, 15513221, 15631907, 15655733, 15695419, 15726947,
    # 15766537, 15798509, 15830137, 15965207,
    # 16767089, 16848721, 16931461, 16964561, 17088107, 17194693,
    # 17260889, 17336087, 17411813, 17461541,
    # 18307537, 18393217, 18410377, 18496297, 18556463, 18590743,
    # 18677083, 18762743, 18832351, 18910201,
    # 19951973, 19978691, 20068879, 20113781, 20238697, 20274893,
    # 20355743, 20464727, 20545589, 20627363,
    # 21509363, 21592673, 21732563, 21891277, 21909997, 21956747,
    # 22003717, 22096901, 22162663, 22303129,
    # 23403643, 23480467, 23528837, 23606281, 23673731, 23742529,
    # 23781529, 23879633, 24066811, 24145547,
    #
    # 20545093, 20698921, 20793197, 20851627, 20944589, 20992003,
    # 21031427, 21057977, 21186047, 21350377,
    # 22296793, 22397129, 22443643, 22487713, 22610101, 22756817,
    # 22819409, 22902527, 22938703, 23009989,
    # 23889367, 23970599, 23999009, 24167393, 24237991, 24297547,
    # 24370729, 24506171, 24583627, 24791807,
    # 25692509, 25751417, 25808009, 25857991, 26086139, 26115809,
    # 26193823, 26255683, 26485157, 26549753,
    # 27404903, 27493951, 27592501, 27707549, 27766517, 27811249,
    # 27910501, 28045153, 28187557, 28348841,
    # 29593117, 29746501, 29812357, 29902601, 30024859, 30046903,
    # 30120637, 30216559, 30305071, 30391367,
    #
    # 27339941, 27403109, 27528509, 27623327, 27750143, 27844613,
    # 27907589, 28002239, 28151611, 28374013,
    # 29321441, 29386457, 29537929, 29614139, 29657827, 29701411,
    # 29809919, 29886793, 29941559, 30028879,
    # 31132919, 31177807, 31233557, 31402607, 31447639, 31503833,
    # 31537607, 31638689, 31773653, 31989247,
    # 32968163, 33071501, 33163777, 33232921, 33395077, 33452807,
    # 33533377, 33591407, 33801371, 33836333,
    # 34784723, 34890533, 35090527, 35137703, 35315153, 35350691,
    # 35553013, 35636411, 35792689, 35840569,
    # 37123049, 37269581, 37355023, 37464877, 37587397, 37745927,
    # 37820099, 37918939, 38017531, 38116427,
    #
    # 52826953, 52857529, 53165989, 53236817, 53413849, 53586641,
    # 53697977, 53892413, 53996941, 54310433,
    # 55752649, 55835903, 56094163, 56188543, 56252893, 56315893,
    # 56511773, 56620367, 56727607, 56862257,
    # 58978301, 59021783, 59163619, 59262037, 59350847, 59404157,
    # 59493067, 59688901, 59847673, 60070151,
    # 62015819, 62134511, 62268461, 62367677, 62476793, 62576153,
    # 62786767, 62934953, 63058069, 63126439,
    # 65026111, 65227021, 65629513, 65731273, 65998909, 66078923,
    # 66337087, 66569999, 66757021, 66861679,
    # 68548541, 68783171, 68971163, 69265957, 69403039, 69722447,
    # 69782143, 69851983, 70016603, 70121543,
    #
    # 38837167, 38925001, 39214559, 39262529, 39408937, 39452573,
    # 39500687, 39600391, 39667721, 39796699,
    # 41494393, 41572079, 41760469, 41846461, 42002297, 42039203,
    # 42109027, 42298079, 42512227, 42541087,
    # 44252029, 44373583, 44453911, 44601211, 44715241, 44744761,
    # 44901023, 44990417, 45104273, 45287551,
    # 47344489, 47374753, 47620843, 47711863, 47772583, 47863723,
    # 47990639, 48264851, 48331223, 48474977,
    # 50332553, 50435071, 50706233, 50909623, 50968693, 51040499,
    # 51152947, 51286577, 51445879, 51558791,
    # 53504299, 53622433, 53743909, 53935961, 53977643, 54151063,
    # 54224969, 54401891, 54798053, 54940009


    1407947,	1446743,	1461323,	1492451,	1506671,	1529107,	1545673,	1569569,	1582543,	1596193,	1609259,	1624631,	1665497,	1673003,	1689839,	1708489,	1737251,	1757947,	1769219,	1785887,	1806157,	1816981,	1833277,	1857019,	1874813,	1893847,	1927207,	1950191,	1983181,	1993961,	2010461,	2025019,	2038489,	2053151,	2077697,	2086103,	2100349,	2122271,	2130773,
    2148413,	2206181,	2224109,	2247601,	2288317,	2326537,	2348803,	2374987,	2415911,	2425013,	2434667,	2459251,	2490287,	2500073,	2518049,	2540119,	2569837,	2596193,	2608597,	2642399,	2654887,	2667991,	2681711,	2721311,	2758153,	2791013,	2825233,	2861003,	2890133,	2910653,	2931857,	2942483,	2963783,	2974457,	3016733,	3043501,	3064549,	3078017,	3114703,
    3129527,	3159329,	3174277,	3229801,	3279203,	3304381,	3322331,	3332993,	3384307,	3399091,	3416689,	3447053,	3488467,	3495967,	3533587,	3574273,	3604061,	3626957,	3660479,	3701491,	3721121,	3733043,	3755111,	3801911,	3826643,	3881167,	3901861,	3947039,	3984401,	4000981,	4028263,	4047553,	4089983,	4139437,	4169023,	4206913,	4235447,	4279381,	4323509,
    4335719,	4387199,	4422917,	4476737,	4498267,	4532347,	4557991,	4579121,	4591703,	4624927,	4647421,	4705661,	4741153,	4749889,	4785533,	4826603,	4862491,	4905599,	4946537,	4959623,	4973321,	4990621,	5022907,	5064289,	5094443,	5145793,	5163413,	5207869,	5226181,	5243921,	5294227,	5331187,	5388667,	5456831,	5524121,	5578973,	5621351,	5679743,	5693777,
    5717407,	5742301,	5796719,	5851751,	5889343,	5914633,	5966783,	6000781,	6020437,	6079597,	6117217,	6198781,	6219401,	6234083,	6268837,	6293627,	6323831,	6370877,	6391753,	6412033,	6431717,	6467023,	6487423,	6508487,	6555509,	6595993,	6617213,	6679817,	6710309,	6736591,	6804053,	6850859,	6897197,	6913307,	7000891,	7061321,	7094393,	7157441,	7204319,
    7231513,	7252493,	7290007,	7368203,	7412851,	7465247,	7532183,	7581449,	7608763,	7659397,	7721299,	7777039,	7814801,	7863839,	7898147,	7931951,	7965827,	7983077,	8064311,	8081693,	8126689,	8172433,	8195353,	8239381,	8268479,	8320721,	8359591,	8406647,	8464171,	8487499,	8547263,	8633693,	8698891,	8710711,	8774189,	8859563,	8877101,	8933411,	9011773,
    9041519,	9072013,	9131753,	9168113,	9203837,	9273259,	9322123,	9418147,	9443459,	9474613,	9506503,	9574217,	9695761,	9747853,	9778799,	9816419,	9854111,	9872633,	9983671,	9996331,	10065773,	10104593,	10154257,	10207357,	10251211,	10284277,	10373729,	10400197,	10490153,	10522279,	10604537,	10722941,	10782383,	10801781,	10863431,	10966121,	10986323,	11062979,	11130319,
    11189557,	11222747,	11296981,	11324561,	11365661,	11399119,	11433889,	11531297,	11570921,	11591663,	11637889,	11713451,	11820317,	11860493,	11928349,	11969869,	12004823,	12039229,	12087599,	12114847,	12178549,	12246673,	12330889,	12344953,	12395167,	12449743,	12529133,	12550091,	12636563,	12692947,	12794791,	12875117,	12925723,	13016821,	13045121,	13067123,	13109351,	13241363,	13285703,
    13352333,	13438457,	13483721,	13526657,	13591451,	13628689,	13643473,	13702061,	13790489,	13812479,	13887619,	13990967,	14013113,	14073781,	14135833,	14173799,	14211193,	14242013,	14317033,	14355239,	14451781,	14595751,	14687671,	14703019,	14733739,	14811983,	14858243,	14881721,	14936143,	15058231,	15098077,	15144781,	15228947,	15341119,	15410797,	15426517,	15490121,	15593023,	15670219,
    15702587,	15792193,	15823397,	15918449,	15991979,	16016309,	16093981,	16228463,	16326047,	16366177,	16407691,	16522703,	16547441,	16611997,	16628317,	16684519,	16733611,	16749991,	16840553,	16865531,	16990661,	17108821,	17192297,	17320981,	17378359,	17412407,	17478631,	17519497,	17569801,	17706277,	17787941,	17838629,	17957857,	18033259,	18094493,	18177013,	18228253,	18298061,	18394039,
    18427727,	18519973,	18555137,	18659429,	18735599,	18769567,	18867509,	18984319,	19046353,	19174699,	19192231,	19288469,	19322977,	19436503,	19479613,	19551041,	19604177,	19690081,	19804627,	19822447,	19885969,	19939561,	19985347,	20150839,	20223431,	20276147,	20348971,	20438687,	20519189,	20644933,	20738693,	20793413,	20867797,	21004171,	21049057,	21241303,	21287789,	21315839,	21362401,
    21417937,	21513281,	21576679,	21642781,	21773317,	21937693,	22002307,	22039163,	22112947,	22293941,	22331041,	22435559,	22519877,	22607939,	22665767,	22722971,	22789453,	22906297,	23031979,	23051191,	23089639,	23184563,	23222443,	23280343,

])
# values = list(range(10**8, 10**10, 10**8))
algos = ('lenstra',)
iters, times = {algo: {} for algo in algos}, {algo: {} for algo in algos}


def avg_time_lenstra(n):
    num = 40
    avg_duration = 0
    counter = 0
    for i in range(num):
        avg_duration += lenstra(n)[1]
        if lenstra(n)[1] != 0:
            counter += 1
    return avg_duration / num

# def avg_time_rho(n):
#     num = 5
#     avg_duration = 0
#     for i in range(num):
#         avg_duration += pollards_rho(n)[1]
#     return avg_duration / num

for value in values:
    print(f'Розмір задачі = {value}:')
    print('\tЛенстра:', end=' ')
    # _, iters['Алгоритм Ленстри'][value], times['Алгоритм Ленстри'][value] = \
    # _, times['lenstra'][value] = lenstra(value)
    times['lenstra'][value] = (avg_time_lenstra(value))


    # print('\tРо-алгоритм Полларда:', end=' ')
    # times['rho-pollard'][value] = avg_time_rho(value)
    # print('\tМаліцький Tam:', end=' ')
    # _, iters['Маліцький Tam'][size], times['Маліцький Tam'][size] = \
    #     src.malitskyi_tam(
    #         x0_initial=np.ones(size),
    #         x1_initial=np.ones(size),
    #         lambda_=0.4,
    #         A=lambda x: a.dot(x),
    #         ProjectionOntoC=lambda x: x,
    #         tolerance=1e-3,
    #         max_iterations=1e4,
    #         debug=True)
    print()

# src.save_values_to_table(times, values, fn='1/time', tp='time')
# src.save_values_to_table(iters, values, fn='1/iter', tp='iter')

save_values_to_image(times,
                     values,
                     tp='time',
                     fp='1',
                     styles=('c-', 'm-', 'm--', 'y-', 'y--', 'w-', 'w--'))

